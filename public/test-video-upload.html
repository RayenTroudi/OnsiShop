<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Video Upload Test</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
  <div class="max-w-2xl mx-auto p-8">
    <h1 class="text-3xl font-bold mb-8">Video Upload Test</h1>
    
    <div class="bg-white rounded-lg shadow-md p-6">
      <h2 class="text-xl font-semibold mb-4">Test Video Upload API</h2>
      
      <input type="file" id="videoFile" accept="video/*" class="mb-4 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
      
      <button onclick="uploadVideo()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors">
        Upload Video
      </button>
      
      <div id="progress" class="mt-4 hidden">
        <div class="w-full bg-gray-200 rounded-full h-2">
          <div id="progressBar" class="bg-blue-500 h-2 rounded-full" style="width: 0%"></div>
        </div>
        <p id="progressText" class="text-sm text-gray-600 mt-1">0%</p>
      </div>
      
      <div id="result" class="mt-4"></div>
    </div>
    
    <div class="mt-8 bg-white rounded-lg shadow-md p-6">
      <h2 class="text-xl font-semibold mb-4">LazyVideo Component Test</h2>
      <div id="videoContainer">
        <p class="text-gray-600">Upload a video to test the LazyVideo component</p>
      </div>
    </div>
  </div>

  <script>
    async function uploadVideo() {
      const fileInput = document.getElementById('videoFile');
      const file = fileInput.files[0];
      
      if (!file) {
        alert('Please select a video file');
        return;
      }
      
      const progressDiv = document.getElementById('progress');
      const progressBar = document.getElementById('progressBar');
      const progressText = document.getElementById('progressText');
      const resultDiv = document.getElementById('result');
      
      progressDiv.classList.remove('hidden');
      resultDiv.innerHTML = '';
      
      try {
        const formData = new FormData();
        formData.append('video', file);
        
        // Simulate progress
        let progress = 0;
        const progressInterval = setInterval(() => {
          progress += Math.random() * 15;
          if (progress > 90) progress = 90;
          progressBar.style.width = progress + '%';
          progressText.textContent = Math.round(progress) + '%';
        }, 100);
        
        const response = await fetch('/api/upload/video', {
          method: 'POST',
          body: formData
        });
        
        clearInterval(progressInterval);
        progressBar.style.width = '100%';
        progressText.textContent = '100%';
        
        if (response.ok) {
          const result = await response.json();
          resultDiv.innerHTML = '<div class="p-4 bg-green-100 text-green-700 rounded">Video uploaded successfully! URL: ' + result.url + '</div>';
          
          // Test LazyVideo component
          testLazyVideo(result.url);
        } else {
          const error = await response.json();
          resultDiv.innerHTML = '<div class="p-4 bg-red-100 text-red-700 rounded">Error: ' + error.error + '</div>';
        }
      } catch (error) {
        resultDiv.innerHTML = '<div class="p-4 bg-red-100 text-red-700 rounded">Error: ' + error.message + '</div>';
      } finally {
        setTimeout(() => {
          progressDiv.classList.add('hidden');
        }, 2000);
      }
    }
    
    function testLazyVideo(videoUrl) {
      const container = document.getElementById('videoContainer');
      container.innerHTML = `
        <div class="text-center">
          <p class="text-gray-600 mb-4">Video uploaded successfully! Testing LazyVideo component...</p>
          <video controls class="w-full max-w-lg mx-auto rounded-lg shadow-md">
            <source src="${videoUrl}" type="video/mp4">
            Your browser does not support the video tag.
          </video>
        </div>
      `;
    }
  </script>
</body>
</html>