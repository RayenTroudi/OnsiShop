<!DOCTYPE html>
<html>
<head>
    <title>Video Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        video { width: 100%; max-width: 800px; height: auto; }
        .status { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .info { background: #d1ecf1; border: 1px solid #b8daff; color: #0c5460; }
    </style>
</head>
<body>
    <h1>🎬 Video Loading Test</h1>
    
    <div id="status"></div>
    
    <video id="testVideo" controls preload="metadata" style="display: none;">
        <source src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4" type="video/mp4">
        Your browser does not support the video tag.
    </video>
    
    <script>
        const video = document.getElementById('testVideo');
        const status = document.getElementById('status');
        
        function addStatus(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.textContent = message;
            status.appendChild(div);
            console.log(message);
        }
        
        addStatus('🔄 Starting video test...');
        addStatus('📹 Video URL: https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4');
        
        video.addEventListener('loadstart', () => {
            addStatus('⏳ Video loading started...', 'info');
        });
        
        video.addEventListener('loadedmetadata', () => {
            addStatus('📊 Video metadata loaded successfully', 'success');
            addStatus(`📐 Video dimensions: ${video.videoWidth}x${video.videoHeight}`, 'info');
            addStatus(`⏱️ Video duration: ${video.duration.toFixed(2)}s`, 'info');
            video.style.display = 'block';
        });
        
        video.addEventListener('canplay', () => {
            addStatus('✅ Video can start playing', 'success');
        });
        
        video.addEventListener('canplaythrough', () => {
            addStatus('🚀 Video can play through without buffering', 'success');
        });
        
        video.addEventListener('error', (e) => {
            addStatus(`❌ Video error: ${e.message || 'Unknown error'}`, 'error');
            if (video.error) {
                addStatus(`❌ Video error code: ${video.error.code}`, 'error');
                addStatus(`❌ Video error message: ${video.error.message}`, 'error');
            }
        });
        
        video.addEventListener('abort', () => {
            addStatus('⏹️ Video loading aborted', 'error');
        });
        
        video.addEventListener('stalled', () => {
            addStatus('⚠️ Video loading stalled', 'error');
        });
        
        video.addEventListener('suspend', () => {
            addStatus('⏸️ Video loading suspended', 'info');
        });
        
        // Test basic fetch to check CORS
        fetch('https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4', {
            method: 'HEAD'
        })
        .then(response => {
            addStatus(`🌐 Fetch test status: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');
            addStatus(`📄 Content-Type: ${response.headers.get('Content-Type')}`, 'info');
            addStatus(`📦 Content-Length: ${response.headers.get('Content-Length')} bytes`, 'info');
        })
        .catch(error => {
            addStatus(`❌ Fetch error: ${error.message}`, 'error');
        });
        
        // Start loading the video
        setTimeout(() => {
            addStatus('🎬 Loading video...', 'info');
            video.load();
        }, 1000);
    </script>
</body>
</html>