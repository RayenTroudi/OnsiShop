<!DOCTYPE html>
<html>
<head>
    <title>Hero Video Loading Test</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-results { background: #f5f5f5; padding: 15px; border-radius: 8px; margin: 20px 0; }
        .log-item { margin: 5px 0; font-family: monospace; font-size: 14px; }
        .success { color: green; }
        .warning { color: orange; }
        .error { color: red; }
        iframe { width: 100%; height: 600px; border: 1px solid #ccc; border-radius: 8px; }
    </style>
</head>
<body>
    <h1>üé¨ Hero Video Loading Test</h1>
    <p>Testing if the hero video loading task is properly completed when served from cache.</p>
    
    <div class="test-results">
        <h3>Test Console Logs:</h3>
        <div id="logs"></div>
    </div>
    
    <h3>Homepage (with video loading fix):</h3>
    <iframe src="http://localhost:3000" id="homepage-frame"></iframe>
    
    <script>
        // Capture console logs
        const logsDiv = document.getElementById('logs');
        const originalLog = console.log;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            
            const logDiv = document.createElement('div');
            logDiv.className = 'log-item';
            const message = args.join(' ');
            
            if (message.includes('‚úÖ')) {
                logDiv.className += ' success';
            } else if (message.includes('‚ö†Ô∏è') || message.includes('‚ùå')) {
                logDiv.className += ' warning';
            } else if (message.includes('‚ùå')) {
                logDiv.className += ' error';
            }
            
            logDiv.textContent = new Date().toLocaleTimeString() + ': ' + message;
            logsDiv.appendChild(logDiv);
            logsDiv.scrollTop = logsDiv.scrollHeight;
        };
        
        // Test when iframe loads
        document.getElementById('homepage-frame').onload = function() {
            console.log('üì± Homepage iframe loaded');
            
            setTimeout(() => {
                try {
                    const frame = this.contentWindow;
                    if (frame && frame.document) {
                        // Run tests inside iframe
                        const script = frame.document.createElement('script');
                        script.textContent = `
                            // Test hero video loading completion
                            const testHeroVideoLoading = () => {
                              console.log('üß™ Testing hero video loading...');
                              
                              // Wait for page to fully load
                              setTimeout(() => {
                                // Check loading context state
                                const loadingIndicators = document.querySelectorAll('[data-loading="true"]');
                                const loadingTexts = document.querySelectorAll('*');
                                
                                console.log('üìä Found ' + loadingIndicators.length + ' loading indicators');
                                
                                // Look for loading tasks
                                let foundLoadingTask = false;
                                loadingTexts.forEach(el => {
                                  if (el.textContent && el.textContent.includes('hero-video')) {
                                    console.log('üîç Found hero-video loading task:', el.textContent);
                                    foundLoadingTask = true;
                                  }
                                });
                                
                                // Check video elements
                                const videoElements = document.querySelectorAll('video');
                                console.log('üé¨ Found ' + videoElements.length + ' video elements');
                                
                                videoElements.forEach((video, index) => {
                                  console.log('Video ' + (index + 1) + ':', {
                                    src: video.src ? video.src.substring(0, 100) + '...' : 'No src',
                                    readyState: video.readyState,
                                    duration: video.duration,
                                    paused: video.paused,
                                    ended: video.ended,
                                    error: video.error ? video.error.message : 'No error'
                                  });
                                  
                                  // Check if video has data: URL (cached)
                                  if (video.src && video.src.startsWith('data:')) {
                                    console.log('üì¶ Video is served from cache (data URL)');
                                    
                                    // Check if video is ready to play
                                    if (video.readyState >= 3) { // HAVE_FUTURE_DATA or higher
                                      console.log('‚úÖ Video is ready to play');
                                    }
                                  }
                                });
                                
                                if (!foundLoadingTask) {
                                  console.log('‚úÖ No hero-video loading task found - loading completed successfully!');
                                } else {
                                  console.log('‚ö†Ô∏è Hero-video loading task still active');
                                }
                                
                              }, 2000);
                              
                              // Check again after more time
                              setTimeout(() => {
                                const stillLoading = Array.from(document.querySelectorAll('*')).some(el => 
                                  el.textContent && el.textContent.includes('hero-video')
                                );
                                
                                if (stillLoading) {
                                  console.log('‚ùå Hero video still loading after 5 seconds');
                                } else {
                                  console.log('‚úÖ Hero video loading completed within 5 seconds');
                                }
                              }, 5000);
                            };

                            // Run the test
                            if (document.readyState === 'loading') {
                              document.addEventListener('DOMContentLoaded', testHeroVideoLoading);
                            } else {
                              testHeroVideoLoading();
                            }
                        `;
                        frame.document.body.appendChild(script);
                    }
                } catch (e) {
                    console.log('‚ö†Ô∏è Cannot access iframe content (cross-origin)');
                }
            }, 1000);
        };
    </script>
</body>
</html>